#!/usr/bin/env bash

set -e

function speak(){
  echo "========== $(date -u '+%Y-%m-%d_%H:%M:%S') $1 =========="
}

speak "Starting..."

while true; do
  read -r -p "Do you wish to use proxy to download dotfiles? " -e yn
  case $yn in
    [Yy]* )
      read -r -p "Please input proxy address and port(ex: http://proxy.example.com:8080). " proxy_uri
      export http_proxy "$proxy_uri"
      export https_proxy "$proxy_uri"
      break;;
    [Nn]* )
      break;;
    * )
      echo "Please answer yes or no.";;
  esac
done

speak "Install Ansible..."

yum install -y python python-setuptools gcc python-devel libffi-devel openssl-devel

easy_install pip ansible

speak "Downloading playbook..."

curl -fsSL "https://raw.githubusercontent.com/IMOKURI/dotfiles/master/setup.yaml" -o ~/.setup.yaml

speak "Run Ansible Playbook..."

ansible-playbook ~/.setup.yaml --tags "initialize,deploy"

speak "Finished!"
